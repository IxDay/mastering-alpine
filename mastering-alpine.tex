\documentclass{beamer}
\usetheme{Perso}

\usepackage[outputdir=build]{minted}
\setminted{breaklines}
\newminted{text}{frame=single}
\usemintedstyle{tango}

\title{Mastering Alpine Linux}
\date{\today}
\author{Maxime Vidori}

\begin{document}

\begin{frame}
  \titlepage
\end{frame}


\begin{frame}
  \frametitle{Alpine?}
  \framesubtitle{Never heard of it...}
  What's in the box?
  \begin{itemize}
    \item \textbf{provide a package manager and a small footprint} (v3.5 \char`~4MB).
    \item Based on busybox and musl-libc.
    \item Can be used as a distribution and come with a grsec kernel.
  \end{itemize}
  How can this helps me?
  \begin{itemize}
    \item Easier to understand and deploy.
    \item Force you to investigate time in your system, and production
      environment.
    \item Reduce security risks by mastering your toolchain,
      \textbf{no more third party unknown containers!}
  \end{itemize}
\end{frame}

\begin{frame}
  \frametitle{Alpine?}
  \framesubtitle{musl libc}
  \begin{block}{musl}
    \textit{lightweight, fast, simple, free,} and strives to be
    \textit{correct} in the sense of standards-conformance and safety.
    \end{block}
  \begin{itemize}
    \item Replacement for the \textbf{glibc}, works most of the time.
    \item \textbf{\char`~600KB} vs \textbf{\char`~8MB} for complete .so set.
    \item Some softwares will not compile (I am looking at you \textbf{systemd}).
  \item You can still install it, but this is crappy and not
      recommended outside a chroot (see the documentation).
  \end{itemize}
\end{frame}

\begin{frame}
  \frametitle{Alpine?}
  \framesubtitle{busybox}
  \begin{block}{busybox}
    The Swiss Army knife of Embedded Linux
  \end{block}
  \begin{itemize}
    \item Simple binary with minimal versions of common UNIX utilities
      (rm, ls, ...).
    \item Minimal size (\textbf{\char`~2MB})
    \item Primarily designed as a recovery tool.
    \item Used by major projects such as Debian for the installation.
  \end{itemize}
\end{frame}

\begin{frame}{Why using it?}
    Masterize your toolchain, avoid using third party unknown containers
\end{frame}

\begin{frame}{Why using it?}
  Can create small containers, 15-20MB for a binary one is common,
    ~50MB for a python one
\end{frame}

\begin{frame}{When not using it}
  Based on musl-libc -> limitations here (some package do not compile)
\end{frame}

\begin{frame}{When not using it}
  When building big images the small footprint is no longer an advantage
    (cross compiler can be really huge)
\end{frame}

\begin{frame}{When not using it}
  package library is not exhaustive (10G big), this is not a debian distrib
    if a lot of dependencies are involved do not use it
\end{frame}
\begin{frame}{Tooling}{}
  \begin{itemize}
    \item Busybox does not provide a package manager.
    \item Debian repo is more than \textbf{200G}, packaging is hard and can become messy.
    \item
  \end{itemize}
  Let's build a pipeline around this to speed up our workflow.
  \flushright{\LARGE \textbf{It's all about tooling!}}
\end{frame}


\begin{frame}[fragile]
  \frametitle{Tooling}
  \framesubtitle{Build your binary}
  virtual package switch:  \mintinline{shell}{apk add -t virtual} \\
  build container \textbf{\char`~200MB}$\,\to\,$prod container
  \textbf{\char`~11MB}

  \begin{minted}{docker}
FROM alpine:3.4

ENV REPO "https://raw.githubusercontent.com/.../hello.go"
RUN apk add --no-cache -t build-dependencies go curl \
  && curl -o /tmp/hello.go "$REPO" \
  && go build -ldflags '-w -s' -o /usr/local/bin/hello /tmp/hello.go \
  && rm /tmp/hello.go \
  && apk del build-dependencies

CMD ["/usr/local/bin/hello"]
  \end{minted}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Tooling}
  \framesubtitle{Build your mirror}

  \begin{block}{Murphy's law}
    Anything that can go wrong will go wrong.
  \end{block}

    \begin{itemize}
      \item Small footprint (\char`~5G)
      \item Rapid builds, offline builds
      \item Push your custom package
  \end{itemize}

  \begin{minted}{shell}
REPO_URL="rsync://${mirror}/alpine/v3.4/main/x86_64"

/usr/bin/rsync ${rsync_opts} ${REPO_URL} /tmp/alpine
/usr/bin/darkhttpd --port 8000 /tmp/alpine
  \end{minted}
\end{frame}

\begin{frame}
  \frametitle{Tooling}
  \framesubtitle{Build your package}

\end{frame}

\begin{frame}{Tooling}
  Build a package
\end{frame}
\end{document}
